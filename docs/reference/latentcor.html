<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Estimate latent correlation for mixed types. — latentcor • latentcor</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate latent correlation for mixed types. — latentcor"><meta property="og:description" content="Estimation of latent correlation matrix from observed data of (possibly) mixed types (continuous/binary/truncated/ternary) based on the latent Gaussian copula model. Missing values (NA) are allowed. The estimation is based on pairwise complete observations."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">latentcor</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/latentcor.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/latentcor_math.html">Mathematical Framework for latentcor</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Estimate latent correlation for mixed types.</h1>
    
    <div class="hidden name"><code>latentcor.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Estimation of latent correlation matrix from observed data of (possibly) mixed types (continuous/binary/truncated/ternary) based on the latent Gaussian copula model. Missing values (NA) are allowed. The estimation is based on pairwise complete observations.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">latentcor</span><span class="op">(</span></span>
<span>  <span class="va">X</span>,</span>
<span>  types <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"approx"</span>, <span class="st">"original"</span><span class="op">)</span>,</span>
<span>  use.nearPD <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  nu <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>  tol <span class="op">=</span> <span class="fl">1e-08</span>,</span>
<span>  ratio <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>  showplot <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>X</dt>
<dd><p>A numeric matrix or numeric data frame (n by p), where n is number of samples, and p is number of variables. Missing values (NA) are allowed, in which case the estimation is based on pairwise complete observations.</p></dd>


<dt>types</dt>
<dd><p>A vector of length p indicating the type of each of the p variables in <code>X</code>. Each element must be one of <code>"con"</code> (continuous), <code>"bin"</code> (binary), <code>"ter"</code> (ternary) or <code>"tru"</code> (truncated). If the vector has length 1, then all p variables are assumed to be of the same type that is supplied. The default value is <code>NULL</code>, and the variable types are determined automatically using function <code><a href="get_types.html">get_types</a></code>. As automatic determination of variable types takes extra time, it is recommended to supply the types explicitly when they are known in advance.</p></dd>


<dt>method</dt>
<dd><p>The calculation method for latent correlations. Either <code>"original"</code> or <code>"approx"</code>. If <code>method = "approx"</code>, multilinear approximation method is used, which is much faster than the original method, see Yoon et al. (2021) for timing comparisons for various variable types. If <code>method = "original"</code>, optimization of the bridge inverse function is used. The default is <code>"approx"</code>.</p></dd>


<dt>use.nearPD</dt>
<dd><p>Logical indicator. <code>use.nearPD = TRUE</code> gets nearest positive definite matrix for the estimated latent correlation matrix with shrinkage adjustment by <code>nu</code>. Output <code>R</code> is the same as <code>Rpointwise</code> if <code>use.nearPD = FALSE</code>. Default value is <code>TRUE</code>.</p></dd>


<dt>nu</dt>
<dd><p>Shrinkage parameter for the correlation matrix, must be between 0 and 1. Guarantees that the minimal eigenvalue of returned correlation matrix is greater or equal to <code>nu</code>. When <code>nu = 0</code>, no shrinkage is performed, the returned correlation matrix will be semi-positive definite but not necessarily strictly positive definite. When <code>nu = 1</code>, the identity matrix is returned (not recommended).  The default (recommended) value is 0.001.</p></dd>


<dt>tol</dt>
<dd><p>When <code>method = "original"</code>, specifies the desired accuracy of the bridge function inversion via uniroot optimization and is passed to <code><a href="https://rdrr.io/r/stats/optimize.html" class="external-link">optimize</a></code>. The default value is 1e-8. When <code>method = "approx"</code>, this parameter is ignored.</p></dd>


<dt>ratio</dt>
<dd><p>When <code>method = "approx"</code>, specifies the boundary value for multilinear interpolation, must be between 0 and 1. When <code>ratio = 0</code>, no linear interpolation is performed (the slowest execution) which is equivalent to <code>method = "original"</code>. When <code>ratio = 1</code>, linear interpolation is always performed (the fastest execution) but may lead to high approximation errors. The default (recommended) value is 0.9 which controls the approximation error and has fast execution, see Yoon et al. (2021) for details. When <code>method = "original"</code>, this parameter is ignored.</p></dd>


<dt>showplot</dt>
<dd><p>Logical indicator. <code>showplot = TRUE</code> generates a ggplot object <code>plotR</code> with the heatmap of latent correlation matrix <code>R</code>. <code>plotR = NULL</code> if <code>showplot = FALSE</code>. Default value is <code>FALSE</code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p><code>latentcor</code> returns</p><ul><li><p>zratios: A list of of length p corresponding to each variable. Returns NA for continuous variable; proportion of zeros for binary/truncated variables; the cumulative proportions of zeros and ones (e.g. first value is proportion of zeros, second value is proportion of zeros and ones) for ternary variable.</p></li>
<li><p>K: (p x p) Kendall Tau (Tau-a) Matrix for <code>X</code></p></li>
<li><p>R: (p x p) Estimated latent correlation matrix for <code>X</code></p></li>
<li><p>Rpointwise: (p x p) Point-wise estimates of latent correlations for <code>X</code>. This matrix is not guaranteed to be semi-positive definite. This is the original estimated latent correlation matrix without adjustment for positive-definiteness.</p></li>
<li><p>plotR: Heatmap plot of latent correlation matrix <code>R</code>, NULL if <code>showplot = FALSE</code></p></li>
</ul></div>
    <div id="details">
    <h2>Details</h2>
    <p>The function estimates latent correlation by calculating inverse bridge function (Fan et al., 2017) evaluated at the value of sample Kendall's tau (\(\hat \tau\)). The bridge function F connects Kendall's tau to latent correlation r so that \(F(r) = E(\hat \tau)\). The form of function F depends on the variable types (continuous/binary/truncated/ternary), but is exact. The exact form of inverse is not available, so has to be evaluated numerically for each pair of variables leading to <code>Rpointwise</code>.</p>
<p>When <code>method = "original"</code>, the inversion is done numerically by solving $$minimize_r (F(r) - \hat \tau)^2$$ using <code><a href="https://rdrr.io/r/stats/optimize.html" class="external-link">optimize</a></code>. The parameter <code>tol</code> is used to control the accuracy of the solution.</p>
<p>When <code>method = "approx"</code>, the inversion is done approximately by interpolating previously calculated and stored values of \(F^{-1}(\hat \tau)\). This is significantly faster than the original method (Yoon et al., 2021) for binary/ternary/truncated cases, however the approximation errors may be non-negligible on some regions of the space. The parameter <code>ratio</code> controls the region where the interpolation is performed with default recommended value of 0.9 giving a good balance of accuracy and computational speed . Increasing the value of ratio may improve speed (but possibly sacrifice the accuracy), whereas decreasing the value of ratio my improve accuracy (but possibly sacrifice the speed). See Yoon et al. 2021 and vignette for more details.</p>
<p>In case the pointwise estimator <code>Rpointwise</code> is has negative eigenvalues, it is projected onto the space of positive semi-definite matrices using <code>nearPD</code>. The parameter <code>nu</code> further allows to perform additional shrinkage towards identity matrix (desirable in cases where the number of variables p is very large) as
 $$R = (1 - \nu) \tilde R + \nu I,$$
 where \(\tilde R\) is <code>Rpointwise</code> after projection by <code>nearPD</code>.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Fan J., Liu H., Ning Y. and Zou H. (2017) "High dimensional semiparametric latent graphical model for mixed data" <a href="https://doi.org/10.1111/rssb.12168" class="external-link">doi:10.1111/rssb.12168</a>
.</p>
<p>Yoon G., Carroll R.J. and Gaynanova I. (2020) "Sparse semiparametric canonical correlation analysis for data of mixed types" <a href="https://doi.org/10.1093/biomet/asaa007" class="external-link">doi:10.1093/biomet/asaa007</a>
.</p>
<p>Yoon G., Müller C.L., Gaynanova I. (2021) "Fast computation of latent correlations" <a href="https://doi.org/10.1080/10618600.2021.1882468" class="external-link">doi:10.1080/10618600.2021.1882468</a>
.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Example 1 - truncated data type, same type for all variables</span></span></span>
<span class="r-in"><span><span class="co"># Generate data</span></span></span>
<span class="r-in"><span><span class="va">X</span> <span class="op">=</span> <span class="fu"><a href="gen_data.html">gen_data</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">300</span>, types <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"tru"</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">X</span></span></span>
<span class="r-in"><span><span class="co"># Estimate latent correlation matrix with original method and check the timing</span></span></span>
<span class="r-in"><span><span class="va">start_time</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">R_org</span> <span class="op">=</span> <span class="fu">latentcor</span><span class="op">(</span>X <span class="op">=</span> <span class="va">X</span>, types <span class="op">=</span> <span class="st">"tru"</span>, method <span class="op">=</span> <span class="st">"original"</span><span class="op">)</span><span class="op">$</span><span class="va">R</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">start_time</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    user  system elapsed </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    0.53    0.00    0.53 </span>
<span class="r-in"><span><span class="co"># Estimate latent correlation matrix with approximation method and check the timing</span></span></span>
<span class="r-in"><span><span class="va">start_time</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">R_approx</span> <span class="op">=</span> <span class="fu">latentcor</span><span class="op">(</span>X <span class="op">=</span> <span class="va">X</span>, types <span class="op">=</span> <span class="st">"tru"</span>, method <span class="op">=</span> <span class="st">"approx"</span><span class="op">)</span><span class="op">$</span><span class="va">R</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/proc.time.html" class="external-link">proc.time</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">start_time</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    user  system elapsed </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       0       0       0 </span>
<span class="r-in"><span><span class="co"># Heatmap for latent correlation matrix.</span></span></span>
<span class="r-in"><span><span class="va">Heatmap_R_approx</span> <span class="op">=</span> <span class="fu">latentcor</span><span class="op">(</span>X <span class="op">=</span> <span class="va">X</span>, types <span class="op">=</span> <span class="st">"tru"</span>, method <span class="op">=</span> <span class="st">"approx"</span>,</span></span>
<span class="r-in"><span>                             showplot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">plotR</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 2 - ternary/continuous case</span></span></span>
<span class="r-in"><span><span class="va">X</span> <span class="op">=</span> <span class="fu"><a href="gen_data.html">gen_data</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">X</span></span></span>
<span class="r-in"><span><span class="co"># Estimate latent correlation matrix with original method</span></span></span>
<span class="r-in"><span><span class="va">R_nc_org</span> <span class="op">=</span> <span class="fu">latentcor</span><span class="op">(</span>X <span class="op">=</span> <span class="va">X</span>, types <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ter"</span>, <span class="st">"con"</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"original"</span><span class="op">)</span><span class="op">$</span><span class="va">R</span></span></span>
<span class="r-in"><span><span class="co"># Estimate latent correlation matrix with aprroximation method</span></span></span>
<span class="r-in"><span><span class="va">R_nc_approx</span> <span class="op">=</span> <span class="fu">latentcor</span><span class="op">(</span>X <span class="op">=</span> <span class="va">X</span>, types <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ter"</span>, <span class="st">"con"</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"approx"</span><span class="op">)</span><span class="op">$</span><span class="va">R</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Mingze Huang, Grace Yoon, Christian Müller, Irina Gaynanova.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

